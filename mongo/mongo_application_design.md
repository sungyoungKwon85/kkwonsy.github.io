## 애플리케이션 설계  

### 스키마 설계 고려 사항
- 쿼리 및 쓰기의 접근 패턴  
> - 쿼리가 실행되는 빈도를 파악하고 함께 쿼리 되는 데이터를 동일한 도큐먼트에 넣어야 한다    
> - 쿼리에 사용되지 않는 데이터, 자주 사용하지 않는 데이터는 옮기자  

- 카디널리티 
> - 관계가 일대일인지, 일대수백만인지를 고려한다  
> 이를 통해 도큐먼트에 내장할지 참조할지를 결정할 수 있다  

<br>

### 스키마 설계 패턴 
- 다형성 패턴 
> 도큐먼트가 유사하지만 동일하지 않은 구조일 때 적합하다.  

- 속성 패턴
> 정렬하려는 도큐먼트에 필드의 서브셋이 있는 경우,  
> 정렬하려는 필드가 서브셋에 있는 경우 적합하다.  

- 그 외에도 버킷패턴, 이상치 패턴, 계산된 패턴, 서브셋 패턴, 확장된 참조 패턴, 근사 패턴, 트리 패턴, 사전 할당 패턴, 도큐먼트 버전 관리 패턴 등이 있다. 

<br>

### 정규화 vs 비정규화 
데이터를 얼마나 정규화 할지는 늘 중요한 문제..  
몽고 집계 프레임워크는 `$lookup`(left outer join) 단계와의 조인을 제공한다.    
일반적으로 정규화는 쓰기를 빠르게 만들고, 비정규화는 읽기를 빠르게 만든다.  
애플리케이션 특성에 맞춰 설계해야 한다.  

```
> db.stduentClasses.findOne..
{
  "_id": ObjectId..,
  "studentId": ObjectId..,
  "classes": [
    ObjectId..,
    ObjectId..,
  ]
}
```
RDB라면 이런식으로 하겠지만 몽고는 그렇게 안한다.  
읽기를 최적화 하기 위해 비정규화해서 classes를 내장도큐먼트로 구성한다.  
```
{
  "_id": ObjectId..,
  "name": "john",
  "classes": [
    {
      "_id": ObjectId, 
      "class": "Math",
      ...
    },
    ...
  ]
}

```
- 정규화 하는 것이 좋은 경우
> - 정보가 읽히는 빈도에 비해 자주 변경될 때
> - 서브도큐먼트가 클 때
> - 즉각적인 일관성이 필요할 때 
> - 결과에 잘 안쓸 때 
> - 증가량이 많은 도큐먼트 일 떄 
> - 빠른 쓰기가 필요할 때 

